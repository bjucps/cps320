{% extends "base.html" %}

{% block banner_title %}{{ "Upcoming Events" }}{% endblock %}

{% block content %}
<label for="sortBy">Sort:</label>
<select name="sort" id="sortBy">
  <option value="date">By Date</option>
  <option value="name">By Name</option>
  <option value="location">By Location</option>
</select>

<label for="filterBy">Filter by:</label>
<select name="filter" id="filterBy">
  <option value="name">Name</option>
  <option value="date">Date</option>
  <option value="location">Location</option>
</select>


<input type="text" id="filterInput" placeholder="Type to filter..." />

<div id="events-container">
{% if events %}
    {% for event in events %}
        <div class="event"
             data-name="{{ event.name|lower }}"
             data-date="{{ event.EventDate|date:'Y-m-d' }}"
             data-location="{{ event.get_Location_display|lower }}">
            <h2>{{ event.name }}</h2>
            {% if event.image %}
                <img src="{{ event.image.url }}" alt="Image for {{ event.name }}">
            {% endif %}
            <p>{{ event.startDate|date:"M d, Y" }}<br>
               {{ event.StartTime|time:"h:i A" }} - {{ event.EndTime|time:"h:i A" }}</p>
            <p>Located in {{ event.location }}<br>
               Room: {{ event.room }}<br>
               Status: {{ event.status }}</p>
        </div>
    {% endfor %}
{% else %}
    <p>No events at this time.</p>
{% endif %}
</div>

<script>
// Sort
function sortEvents(compareFn) {
    const container = document.getElementById('events-container');
    const items = Array.from(container.querySelectorAll('.event'));
    items.sort(compareFn);
    container.innerHTML = '';
    items.forEach(item => container.appendChild(item));
}

document.getElementById('sortBy').addEventListener('change', function() {
    const sortBy = this.value;
    if (sortBy === 'name') {
        sortEvents((a, b) => a.dataset.name.localeCompare(b.dataset.name));
    } else if (sortBy === 'date') {
        sortEvents((a, b) => new Date(a.dataset.date) - new Date(b.dataset.date));
    } else if (sortBy === 'location') {
        sortEvents((a, b) => a.dataset.location.localeCompare(b.dataset.location));
    }
});

// Filter
const filterBySelect = document.getElementById('filterBy');
const filterInput = document.getElementById('filterInput');
const eventsContainer = document.getElementById('events-container');

filterInput.addEventListener('input', function() {
    const filterType = filterBySelect.value;
    const filterText = this.value.toLowerCase();
    const events = eventsContainer.querySelectorAll('.event');

    events.forEach(event => {
        const dataValue = event.dataset[filterType];
        if (dataValue && dataValue.includes(filterText)) {
            event.style.display = '';   // show
        } else {
            event.style.display = 'none'; // hide
        }
    });
});
</script>
{% endblock %}
